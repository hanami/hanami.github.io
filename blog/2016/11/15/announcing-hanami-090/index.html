<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Hanami - The web, with simplicity" />
<meta name="keywords" content="hanami,hanamirb,lotus,lotusrb,web,framework,ruby,open source,oss,os,software,free,free software,architecture,fast,lightweight,testing,tdd,bdd,test driven development,behaviour driven development,full stack,mvc,model view object,pattern,patterns,design patterns,oop,object oriented programming,testability,http,https,routing,router,http router,restful,resource,resources,convention,controller,models,repository,query,sql,interactors,two-step view,view,template,presenters,render,rendering,helpers,erb,haml,tilt,json,xml,yaml,yml,framwork,framewrok,riby,free sowftare"/>
<meta name="author" content="Luca Guidi">
<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<link href="/atom.xml" rel="alternate" title="Hanami" type="application/atom+xml" />
<link href="/images/favicon.ico" rel="icon" type="image/ico" />

<title>Hanami | Announcing Hanami v0.9.0</title>

<link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,700" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Overpass:200,300,400,700" rel="stylesheet">
<link href="/stylesheets/toolkit-minimal.css" rel="stylesheet" />
<link href="/stylesheets/search.css" rel="stylesheet" />
<link href="/stylesheets/application-minimal.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

    <meta property="og:site_name"   content="Hanami"/>
    <meta property="og:title"       content="Announcing Hanami v0.9.0">
    <meta property="og:url"         content="http://hanamirb.org/blog/2016/11/15/announcing-hanami-090/">
    <meta property="og:description" content="New hanami-model engine based on ROM. Database automapping, data integrity for entities, experimental associations, native PostgreSQL types.">
    <meta property="og:image"       content="http://hanamirb.org/blog/2016/11/15/announcing-hanami-090/cover.jpg">

    <meta name="twitter:card"        content="summary_large_image">
    <meta name="twitter:site"        content="@hanamirb">
    <meta name="twitter:creator"     content="@hanamirb">
    <meta name="twitter:url"         content="http://hanamirb.org/blog/2016/11/15/announcing-hanami-090/">
    <meta name="twitter:title"       content="Announcing Hanami v0.9.0">
    <meta name="twitter:description" content="New hanami-model engine based on ROM. Database automapping, data integrity for entities, experimental associations, native PostgreSQL types.">
    <meta name="twitter:image:src"   content="http://hanamirb.org/blog/2016/11/15/announcing-hanami-090/cover.jpg">
  </head>

  <body>
    <nav id="navigation" class="navbar navbar-default navbar-static-top navbar-padded app-navbar">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed p-x-0" data-toggle="collapse" data-target="#navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="navbar-brand text-uppercase" href="/">
        <span>Hanami</span>
      </a>
    </div>

    <div class="navbar-collapse collapse" id="navbar-collapse">
      <ul class="nav navbar-nav navbar-right text-uppercase">
        <li>
          <a href="https://guides.hanamirb.org" target="_blank">Guides</a>
        </li>
        <li>
          <a href="https://docs.hanamirb.org" target="_blank">API</a>
        </li>
        <li>
          <a href="/community">Community</a>
        </li>
        <li>
          <a href="/donate">Donate</a>
        </li>
        <li>
          <a href="https://github.com/hanami" target="_blank">Source Code</a>
        </li>
        <li>
          <a href="/blog">Blog</a>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

<div id="hanami2" class="text-xs-center">
  <div class="container">
    <div class="row">
      We're working on <strong>Hanami 2.0</strong>. Read the <a href="/blog/2021/05/04/announcing-hanami-200alpha2/">latest announcement</a> and follow the <a href="https://github.com/hanami/hanami/tree/unstable">progress</a> on GitHub.
    </div>
  </div>
</div>



    <div class="container">
      <div class="block block-inverse text-center">
        <div class="block-foreground">
          <h1 class="block-title">Announcing Hanami v0.9.0</h1>
          <h4 class="text-muted">Posted by <strong>Luca Guidi</strong> on <em>November 15, 2016</em></h4>
          <button class="btn btn-default btn-outline m-t">
            <span class="icon icon-facebook"></span>
            Share
          </button>
          <button class="btn btn-default btn-outline m-t">
            <span class="icon icon-twitter"></span>
            Tweet
          </button>
        </div>
        <div class="block-background">
          <img src="/blog/2016/11/15/announcing-hanami-090/cover.jpg" loading="lazy">
        </div>
      </div>

      <div class="container container-article">
        <div class="row">
          <div class="col-xs-12 col-md-8 col-md-offset-1">
            <p class="lead">New hanami-model engine based on ROM. Database automapping, data integrity for entities, experimental associations, native PostgreSQL types.</p>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-xs-12 col-md-9 col-md-offset-1">
            <div class="article-body">
              <p>We rewrote <code>hanami-model</code> from scratch with an engine based on <a href="http://rom-rb.org">ROM</a>.</p>

<p>The result is impressive: it&#39;s faster and more robust.</p>

      <h2 id="features" class="title"><a name="features" class="anchor" href="#features">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Features</h2>
    
      <h3 id="database-automapping" class="title"><a name="database-automapping" class="anchor" href="#database-automapping">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Database Automapping</h3>
    
<p>But there is more, all the <strong>mapping boilerplate is gone</strong>, now using entities and repositories is much <strong>easier</strong>.</p>
<pre class="highlight shell"><code><span style="color: #555555">% </span>bundle <span style="color: #0086B3">exec </span>hanami generate model book
      create  lib/bookshelf/entities/book.rb
      create  lib/bookshelf/repositories/book_repository.rb
      create  spec/bookshelf/entities/book_spec.rb
      create  spec/bookshelf/repositories/book_repository_spec.rb
</code></pre>

<p>This is the generated entity:</p>
<pre class="highlight ruby"><code><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Book</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Entity</span>
<span style="color: #000000;font-weight: bold">end</span>
</code></pre>

<p>While this is the generated repository:</p>
<pre class="highlight ruby"><code><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">BookRepository</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Repository</span>
<span style="color: #000000;font-weight: bold">end</span>
</code></pre>

<p>Then we generate the migration:</p>
<pre class="highlight shell"><code><span style="color: #555555">% </span>bundle <span style="color: #0086B3">exec </span>hanami generate migration create_books
      create  db/migrations/20161113154510_create_books.rb
</code></pre>

<p>Let&#39;s edit the migration with the following code:</p>
<pre class="highlight ruby"><code><span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Model</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">migration</span> <span style="color: #000000;font-weight: bold">do</span>
  <span style="background-color: #f8f8f8">change</span> <span style="color: #000000;font-weight: bold">do</span>
    <span style="background-color: #f8f8f8">create_table</span> <span style="color: #990073">:books</span> <span style="color: #000000;font-weight: bold">do</span>
      <span style="background-color: #f8f8f8">primary_key</span> <span style="color: #990073">:id</span>
      <span style="background-color: #f8f8f8">column</span> <span style="color: #990073">:title</span><span style="background-color: #f8f8f8">,</span>      <span style="color: #008080">String</span>
      <span style="background-color: #f8f8f8">column</span> <span style="color: #990073">:created_at</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">DateTime</span>
      <span style="background-color: #f8f8f8">column</span> <span style="color: #990073">:updated_at</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">DateTime</span>
    <span style="color: #000000;font-weight: bold">end</span>
  <span style="color: #000000;font-weight: bold">end</span>
<span style="color: #000000;font-weight: bold">end</span>
</code></pre>

<p>Now we need to prepare the database to use it:</p>
<pre class="highlight shell"><code><span style="color: #555555">% </span>bundle <span style="color: #0086B3">exec </span>hanami db prepare
</code></pre>

<p>We&#39;re ready to use our repository:</p>
<pre class="highlight ruby"><code><span style="color: #d14">% bundle </span><span style="color: #0086B3">exec</span> <span style="background-color: #f8f8f8">hanami</span> <span style="background-color: #f8f8f8">console</span>
<span style="background-color: #f8f8f8">irb</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">):</span><span style="color: #009999">001</span><span style="background-color: #f8f8f8">:</span><span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">book</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">BookRepository</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">create</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">title: </span><span style="color: #d14">"Hanami"</span><span style="background-color: #f8f8f8">)</span>
<span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #999988;font-style: italic">#&lt;Book:0x007f95ccefb320 @attributes={:id=&gt;1, :title=&gt;"Hanami", :created_at=&gt;2016-11-13 15:49:14 UTC, :updated_at=&gt;2016-11-13 15:49:14 UTC}&gt;</span>
</code></pre>

<p>Learn more about new <a href="/guides/models/repositories">repositories</a>, <a href="/guides/models/entities">entities</a> usage.</p>

      <h3 id="entities-data-integrity" class="title"><a name="entities-data-integrity" class="anchor" href="#entities-data-integrity">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Entities Data Integrity</h3>
    
<p>When using a SQL database, an entity setups an <strong>internal schema</strong>, which is derived <strong>automatically</strong> from the table definition.</p>

<p>Imagine to have the <code>books</code> table defined as:</p>
<pre class="highlight sql"><code><span style="color: #000000;font-weight: bold">CREATE</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">books</span> <span style="background-color: #f8f8f8">(</span>
    <span style="background-color: #f8f8f8">id</span> <span style="background-color: #f8f8f8">integer</span> <span style="color: #000000;font-weight: bold">NOT</span> <span style="color: #000000;font-weight: bold">NULL</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">title</span> <span style="background-color: #f8f8f8">text</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">timestamp</span> <span style="color: #000000;font-weight: bold">without</span> <span style="background-color: #f8f8f8">time</span> <span style="color: #000000;font-weight: bold">zone</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">updated_at</span> <span style="color: #000000;font-weight: bold">timestamp</span> <span style="color: #000000;font-weight: bold">without</span> <span style="background-color: #f8f8f8">time</span> <span style="color: #000000;font-weight: bold">zone</span>
<span style="background-color: #f8f8f8">);</span>
</code></pre>

<p>This is the corresponding entity <code>Book</code>.</p>
<pre class="highlight ruby"><code><span style="color: #999988;font-style: italic"># lib/bookshelf/entities/book.rb</span>
<span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Book</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Entity</span>
<span style="color: #000000;font-weight: bold">end</span>
</code></pre>

<hr>

<p>Let&#39;s instantiate it with proper values:</p>
<pre class="highlight ruby"><code><span style="background-color: #f8f8f8">book</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">Book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">title: </span><span style="color: #d14">"Hanami"</span><span style="background-color: #f8f8f8">)</span>

<span style="background-color: #f8f8f8">book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">title</span>      <span style="color: #999988;font-style: italic"># =&gt; "Hanami"</span>
<span style="background-color: #f8f8f8">book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">created_at</span> <span style="color: #999988;font-style: italic"># =&gt; nil</span>
</code></pre>

<p>The <code>created_at</code> attribute is <code>nil</code> because it wasn&#39;t present when we have instantiated <code>book</code>.</p>

<hr>

<p>It ignores unknown attributes:</p>
<pre class="highlight ruby"><code><span style="background-color: #f8f8f8">book</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">Book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">unknown: </span><span style="color: #d14">"value"</span><span style="background-color: #f8f8f8">)</span>

<span style="background-color: #f8f8f8">book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">unknown</span> <span style="color: #999988;font-style: italic"># =&gt; NoMethodError</span>
<span style="background-color: #f8f8f8">book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">foo</span>     <span style="color: #999988;font-style: italic"># =&gt; NoMethodError</span>
</code></pre>

<p>It raises a <code>NoMethodError</code> both for <code>unknown</code> and <code>foo</code>, because they aren&#39;t part of the internal schema.</p>

<hr>

<p>It can coerce values:</p>
<pre class="highlight ruby"><code><span style="background-color: #f8f8f8">book</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">Book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">created_at: </span><span style="color: #d14">"Sun, 13 Nov 2016 09:41:09 GMT"</span><span style="background-color: #f8f8f8">)</span>

<span style="background-color: #f8f8f8">book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">created_at</span>       <span style="color: #999988;font-style: italic"># =&gt; 2016-11-13 09:41:09 UTC</span>
<span style="background-color: #f8f8f8">book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">created_at</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">class</span> <span style="color: #999988;font-style: italic"># =&gt; Time</span>
</code></pre>

<p>An entity tries as much as it cans to coerce values according to the internal schema.</p>

<hr>

<p>It enforces <strong>data integrity</strong> via exceptions:</p>
<pre class="highlight ruby"><code><span style="color: #008080">Book</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">created_at: </span><span style="color: #d14">"foo"</span><span style="background-color: #f8f8f8">)</span> <span style="color: #999988;font-style: italic"># =&gt; ArgumentError</span>
</code></pre>

<p>If we use this feature, in combination with <a href="/guides/migrations/create-table#constraints">database constraints</a> and validations, we can ensure a <strong>strong</strong> degree of <strong>data integrity</strong> for our projects.</p>

<p>Learn more about Entities <a href="/guides/models/entities#custom-schema">custom schema</a>.</p>

      <h3 id="associations-experimental-" class="title"><a name="associations-experimental-" class="anchor" href="#associations-experimental-">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Associations (experimental)</h3>
    
<p>Hanami finally ships with associations.
We postponed this feature for long time mainly because we didn&#39;t want to replicate ActiveRecord API.
That is a complex beast that took years to get stable.
Its proxy loader design (<code>post.comments</code> to load comments) doesn&#39;t fit Hanami vision of explicitness.</p>

<p>To design an API that is both explicit and reduces the boilerplate is a hard challenge.
But today we can share with you a preview of this experimental feature.</p>
<pre class="highlight ruby"><code><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">AuthorRepository</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Repository</span>
  <span style="background-color: #f8f8f8">associations</span> <span style="color: #000000;font-weight: bold">do</span>
    <span style="background-color: #f8f8f8">has_many</span> <span style="color: #990073">:books</span>
  <span style="color: #000000;font-weight: bold">end</span>

  <span style="color: #000000;font-weight: bold">def</span> <span style="color: #990000;font-weight: bold">create_with_books</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">)</span>
    <span style="background-color: #f8f8f8">assoc</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">:books</span><span style="background-color: #f8f8f8">).</span><span style="color: #990000;font-weight: bold">create</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">)</span>
  <span style="color: #000000;font-weight: bold">end</span>

  <span style="color: #000000;font-weight: bold">def</span> <span style="color: #990000;font-weight: bold">find_with_books</span><span style="background-color: #f8f8f8">(</span><span style="color: #0086B3">id</span><span style="background-color: #f8f8f8">)</span>
    <span style="background-color: #f8f8f8">aggregate</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">:books</span><span style="background-color: #f8f8f8">).</span><span style="color: #990000;font-weight: bold">where</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">authors__id: </span><span style="color: #0086B3">id</span><span style="background-color: #f8f8f8">).</span><span style="color: #990000;font-weight: bold">as</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">Author</span><span style="background-color: #f8f8f8">).</span><span style="color: #990000;font-weight: bold">one</span>
  <span style="color: #000000;font-weight: bold">end</span>
<span style="color: #000000;font-weight: bold">end</span>
</code></pre>

<p>We can create with a single SQL command the parent and the children:</p>
<pre class="highlight ruby"><code><span style="background-color: #f8f8f8">repository</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">AuthorRepository</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span>

<span style="background-color: #f8f8f8">author</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">repository</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">create_with_books</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">name: </span><span style="color: #d14">"Alexander Dumas"</span><span style="background-color: #f8f8f8">,</span> <span style="color: #990073">books: </span><span style="background-color: #f8f8f8">[{</span><span style="color: #990073">title: </span><span style="color: #d14">"The Count of Monte Cristo"</span> <span style="background-color: #f8f8f8">}])</span>
  <span style="color: #999988;font-style: italic"># =&gt; #&lt;Author:0x007f8a08130968 @attributes={:id=&gt;1, :name=&gt;"Alexander Dumas", :created_at=&gt;2016-11-14 20:52:24 UTC, :updated_at=&gt;2016-11-14 20:52:24 UTC, :books=&gt;[#&lt;Book:0x007f8a0812b260 @attributes={:id=&gt;1, :author_id=&gt;1, :title=&gt;"The Count of Monte Cristo", :created_at=&gt;2016-11-14 20:52:24 UTC, :updated_at=&gt;2016-11-14 20:52:24 UTC}&gt;]}&gt;</span>
</code></pre>

<p>The default find, doesn&#39;t preload the associated records:</p>
<pre class="highlight ruby"><code><span style="background-color: #f8f8f8">found</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">repository</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">find</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">author</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">id</span><span style="background-color: #f8f8f8">)</span>
  <span style="color: #999988;font-style: italic"># =&gt; #&lt;Author:0x007f8a07971ce0 @attributes={:id=&gt;1, :name=&gt;"Alexander Dumas", :created_at=&gt;2016-11-14 20:52:24 UTC, :updated_at=&gt;2016-11-14 20:52:24 UTC}&gt;</span>

<span style="background-color: #f8f8f8">found</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">books</span>
  <span style="color: #999988;font-style: italic"># =&gt; nil</span>
</code></pre>

<p>It requires an explicit preload operation:</p>
<pre class="highlight ruby"><code><span style="background-color: #f8f8f8">found</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">repository</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">find_with_books</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">author</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">id</span><span style="background-color: #f8f8f8">)</span>
  <span style="color: #999988;font-style: italic"># =&gt; #&lt;Author:0x007f8a040a6cf8 @attributes={:id=&gt;1, :name=&gt;"Alexander Dumas", :created_at=&gt;2016-11-14 20:52:24 UTC, :updated_at=&gt;2016-11-14 20:52:24 UTC, :books=&gt;[#&lt;Book:0x007f8a040a5970 @attributes={:id=&gt;1, :author_id=&gt;1, :title=&gt;"The Count of Monte Cristo", :created_at=&gt;2016-11-14 20:52:24 UTC, :updated_at=&gt;2016-11-14 20:52:24 UTC}&gt;]}&gt;</span>

<span style="background-color: #f8f8f8">found</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">books</span>
  <span style="color: #999988;font-style: italic"># =&gt; [#&lt;Book:0x007f8a040a5970 @attributes={:id=&gt;1, :author_id=&gt;1, :title=&gt;"The Count of Monte Cristo", :created_at=&gt;2016-11-14 20:52:24 UTC, :updated_at=&gt;2016-11-14 20:52:24 UTC}&gt;]</span>
</code></pre>

<p>Learn more about <a href="/guides/models/associations">associations</a>.</p>

      <h3 id="postgresql-types" class="title"><a name="postgresql-types" class="anchor" href="#postgresql-types">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>PostgreSQL Types</h3>
    
<p><code>hanami-model</code> now supports natively most common PostgreSQL data types such as: <code>UUID</code>, <code>Array</code>, <code>JSON(B)</code></p>
<pre class="highlight ruby"><code><span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Model</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">migration</span> <span style="color: #000000;font-weight: bold">do</span>
  <span style="background-color: #f8f8f8">up</span> <span style="color: #000000;font-weight: bold">do</span>
    <span style="background-color: #f8f8f8">execute</span> <span style="color: #d14">'CREATE EXTENSION IF NOT EXISTS "uuid-ossp"'</span>

    <span style="background-color: #f8f8f8">create_table</span> <span style="color: #990073">:project_files</span> <span style="color: #000000;font-weight: bold">do</span>
      <span style="background-color: #f8f8f8">column</span> <span style="color: #990073">:id</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'uuid'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #990073">null: </span><span style="color: #000000;font-weight: bold">false</span><span style="background-color: #f8f8f8">,</span> <span style="color: #990073">default: </span><span style="color: #008080">Hanami</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Model</span><span style="color: #000000;font-weight: bold">::</span><span style="color: #008080">Sql</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">function</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">:uuid_generate_v4</span><span style="background-color: #f8f8f8">)</span>
      <span style="background-color: #f8f8f8">column</span> <span style="color: #990073">:name</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">String</span>
    <span style="color: #000000;font-weight: bold">end</span>
  <span style="color: #000000;font-weight: bold">end</span>

  <span style="background-color: #f8f8f8">down</span> <span style="color: #000000;font-weight: bold">do</span>
    <span style="background-color: #f8f8f8">drop_table</span> <span style="color: #990073">:project_files</span>
    <span style="background-color: #f8f8f8">execute</span> <span style="color: #d14">'DROP EXTENSION IF EXISTS "uuid-ossp"'</span>
  <span style="color: #000000;font-weight: bold">end</span>
<span style="color: #000000;font-weight: bold">end</span>
</code></pre>
<pre class="highlight ruby"><code><span style="color: #008080">ProjectFileRepository</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">new</span><span style="background-color: #f8f8f8">.</span><span style="color: #990000;font-weight: bold">create</span><span style="background-color: #f8f8f8">(</span><span style="color: #990073">name: </span><span style="color: #d14">"source.rb"</span><span style="background-color: #f8f8f8">)</span>
  <span style="color: #999988;font-style: italic"># =&gt; #&lt;ProjectFile:0x007ff29c4b9740 @attributes={:id=&gt;"239f8e0f-d764-4a76-aaa7-7b59b5301c72", :name=&gt;"source.rb"}&gt;</span>
</code></pre>

<p>Learn more about <a href="/guides/models/postgresql">PostgreSQL data types</a></p>

      <h3 id="misc" class="title"><a name="misc" class="anchor" href="#misc">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Misc</h3>
    
<ul>
<li><p>Hanami is only compatible with Ruby (MRI) 2.3+</p></li>
<li><p>There are several breaking changes, please check the upgrade notes</p></li>
</ul>

      <h2 id="upgrade-notes" class="title"><a name="upgrade-notes" class="anchor" href="#upgrade-notes">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Upgrade Notes</h2>
    
<p>Please have a look at the <a href="/guides/upgrade-notes/v090">upgrade notes for v0.9.0</a>.</p>

      <h2 id="acknowledgements" class="title"><a name="acknowledgements" class="anchor" href="#acknowledgements">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Acknowledgements</h2>
    
<p>A special thanks goes to the ROM team for their support during the hard work of integration between the two frameworks.
Thank you Piotr Solnica, Nikita Shilnikov, Andy Holland, and Tim Riley for your help.</p>

      <h2 id="contributors" class="title"><a name="contributors" class="anchor" href="#contributors">      <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
      <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
      </svg>
</a>Contributors</h2>
    
<p>We&#39;re grateful for each person who contributed to this release.
These lovely people are:</p>

<ul>
<li>Alfonso Uceda</li>
<li>Anton Davydov</li>
<li>Bruz Marzolf</li>
<li>Grachev Mikhail</li>
<li>Ivan Lasorsa</li>
<li>Jakub Pavlík</li>
<li>James Hamilton</li>
<li>Kyle Chong</li>
<li>Lucas Allan</li>
<li>Marion Duprey</li>
<li>Maxim Dzhuliy</li>
<li>Pascal Betz</li>
<li>Russell Cloak</li>
<li>Sean Collins</li>
<li>Tomas Craig</li>
<li>Trung Lê</li>
</ul>

<p>Thank you all!</p>

            </div>

           <hr>

           <a href="https://github.com/hanami/hanami" title="Star on GitHub" target="_blank" class="btn btn-default-outline">
             <span class="icon icon-github"></span>
             Star
           </a>
           <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fhanamirb.org%2Fblog%2F2016%2F11%2F15%2Fannouncing-hanami-090%2F" title="Like on Facebook" class="btn btn-default-outline" target="_blank">
             <span class="icon icon-thumbs-up"></span>
             Like
           </a>
           <a href="https://twitter.com/home?status=Announcing+Hanami+v0.9.0+-+http%3A%2F%2Fhanamirb.org%2Fblog%2F2016%2F11%2F15%2Fannouncing-hanami-090%2F+%2Fvia+%40hanamirb+%23hanamirb" title="Share on Twitter" target="_blank" class="btn btn-default-outline">
             <span class="icon icon-twitter"></span>
             Tweet
           </a>
           <a href="https://news.ycombinator.com/submitlink?u=http%3A%2F%2Fhanamirb.org%2Fblog%2F2016%2F11%2F15%2Fannouncing-hanami-090%2F&t=Announcing Hanami v0.9.0" class="btn btn-default-outline" title="Vote on HackerNews">
             <span class="icon"><strong>HN</strong></span>
             Vote
           </a>
            <a href="http://www.reddit.com/submit?url=http%3A%2F%2Fhanamirb.org%2Fblog%2F2016%2F11%2F15%2Fannouncing-hanami-090%2F" target="_blank" title="Share on Reddit" class="btn btn-default-outline">
             <span class="icon"><strong>R</strong></span>
             Share
            </a>

            <br>
            <br>

            <div class="block block-bordered-lg text-center">
  <div class="container-fluid">
    <p class="lead m-b-md">
    Join a community of over 2,300+ developers.
    </p>
    <form action="https://hanamirb.us3.list-manage.com/subscribe/post" method="POST" class="form-inline">
      <input name="u" value="dcbeefa4ba1ea9ae043857005" type="hidden">
      <input name="id" value="fb3873a90f" type="hidden">
      <input name="orig-lang" value="1" type="hidden">
      <input type="email" class="form-control m-b" placeholder="Email Address" spellcheck="false" autocapitalize="off" autocorrect="off" name="MERGE0" id="MERGE0" value="">
      <button class="btn btn-primary m-b">Subscribe</button>
    </form>
    <small class="text-muted">
      By clicking "Subscribe" I want to subscribe to Hanami mailing list.
    </small>
  </div>
</div>

          </div>
        </div>
      </div>
    </div>

    <div id="lotus" class="text-xs-center">
  <div class="container">
    <div class="row">
      Looking for <strong>Lotus</strong>? We renamed the project and it's now called <strong>Hanami</strong>. Read the <a href="/blog/2016/01/22/lotus-is-now-hanami">announcement</a>.
    </div>
  </div>
</div>


<div class="block app-block-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-2 m-b">
        <ul class="list-unstyled list-spaced">
          <li><h6 class="text-uppercase">Project</h6></li>
          <li><a href="https://github.com/hanami" target="_blank">GitHub</a></li>
          <li><a href="https://twitter.com/hanamirb" target="_blank">Twitter</a></li>
          <li><a href="https://rubygems.org/gems/hanami" target="_blank">Rubygems</a></li>
          <li><a href="/status">Gems Status</a></li>
          <li><a href="/team">Team</a></li>
          <li><a href="/security">Security</a></li>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li><a href="https://guides.hanamirb.org/" target="_blank">Guides</a></li>
          <li><a href="https://docs.hanamirb.org/" target="_blank">Docs</a></li>
        </ul>
      </div>
      <div class="col-sm-2 m-b">
        <ul class="list-unstyled list-spaced">
          <li><h6 class="text-uppercase">Community</h6></li>
          <li><a href="/community#code-of-conduct">Code of Conduct</a></li>
          <li><a href="http://chat.hanamirb.org" target="_blank">Chat</a></li>
          <li><a href="https://discourse.hanamirb.org" target="_blank">Forum</a></li>
          <li><a href="https://stackoverflow.com/questions/tagged/hanami" target="_blank">StackOverflow</a></li>
          <li><a href="/mailing-list">Mailing List</a></li>
          <li><a href="http://awesome-hanami.org" target="_blank">Awesome List</a></li>
          <li><a href="https://www.reddit.com/r/hanamirb/" target="_blank">Reddit</a></li>
          <li><a href="http://contributors.hanamirb.org" target="_blank">Contributors</a></li>
        </ul>
      </div>
      <div class="col-sm-2 m-b">
        <ul class="list-unstyled list-spaced">
          <a href="http://dnsimple.link/resolving-hanami" target="_blank">
            <span>Resolving with<br/></span>
            <img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="display:block;margin:0;padding:0;width:100px;" loading="lazy"/>
          </a>
        </ul>
      </div>
      <div class="col-sm-6">
        <h6 class="text-uppercase">About</h6>
        <p>
          Hanami is a web framework for Ruby &mdash; &copy; 2014-2021 <a href="http://lucaguidi.com" target="_blank">Luca Guidi</a>.<br>
          Released under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>.
          <br><br>
          This project was formerly known as <strong>Lotus</strong>.
        </p>
      </div>
    </div>
  </div>
</div>
<script src="/javascripts/jquery.min.js" type="text/javascript"></script>
<script src="/javascripts/toolkit.js" type="text/javascript"></script>
<script src="/javascripts/application.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47369640-1', 'hanamirb.org');
  ga('send', 'pageview');
</script>

<script>
  ((window.gitter = {}).chat = {}).options = { room: 'hanami/chat' };
</script>
<script src="//sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

  </body>
</html>
